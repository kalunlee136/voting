var app=angular.module("votingApp",["ui.router"]);app.controller("MainCtrl",["$scope","$http","$state","$stateParams",function(e,o,t,n){e.choices=[{loc:0,upvote:0},{loc:1,upvote:0},{loc:2,upvote:0}],e.addNewChoice=function(){var o=e.choices.length;e.choices.push({loc:o,upvote:0}),console.log(e.choices)},e.showAddChoice=function(o){return o.loc===e.choices[e.choices.length-1].loc},e.createPoll=function(){o.post("/polls",{title:e.title,choices:e.choices}).success(function(e){window.location.href="https://voting-kalunlee136.c9users.io/#/polls/"+e._id}).error(function(e){console.log(e)})},e.init=function(){return localStorage[n.id]&&(window.location.href="https://voting-kalunlee136.c9users.io/#/polls/"+n.id+"/r"),o.get("/polls/"+n.id).then(function(o){e.title1=o.data.title,e.choices1=o.data.choices,e.total=0,e.linke="https://voting-kalunlee136.c9users.io/#/polls/"+n.id,e.choices1.forEach(function(o){e.total+=o.upvote}),console.log(e.total)})},e.submitVote=function(){return e.choiceIndex=$("input[type='radio']:checked").val(),e.choices1[e.choiceIndex].upvote+=1,o.put("/polls/"+n.id,{choices:e.choices1}).success(function(e){console.log(e),localStorage.setItem(n.id,!0),window.location.href="https://voting-kalunlee136.c9users.io/#/polls/"+n.id+"/r"}).error(function(e){console.log(e)})}}]),app.controller("AuthCtrl",["$scope","$state","auth",function(e,o,t){e.user={},e.register=function(){t.register(e.user).error(function(o){e.error=o}).then(function(){o.go("home")})},e.logIn=function(){t.logIn(e.user).error(function(o){e.error=o}).then(function(){o.go("home")})}}]),app.controller("NavCtrl",["$scope","auth",function(e,o){e.isLoggedIn=o.isLoggedIn,e.currentUser=o.currentUser,e.logOut=o.logOut}]),app.factory("auth",["$http","$window",function(e,o){var t={};return t.saveToken=function(e){o.localStorage["flapper-news-token"]=e},t.getToken=function(){return o.localStorage["flapper-news-token"]},t.isLoggedIn=function(){var e=t.getToken();if(e){var n=JSON.parse(o.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}return!1},t.currentUser=function(){if(t.isLoggedIn()){var e=t.getToken(),n=JSON.parse(o.atob(e.split(".")[1]));return n.username}},t.register=function(o){return e.post("/register",o).success(function(e){t.saveToken(e.token)})},t.logIn=function(o){return e.post("/login",o).success(function(e){t.saveToken(e.token)})},t.logOut=function(){o.localStorage.removeItem("flapper-news-token")},t}]),app.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("poll",{url:"",views:{header:{templateUrl:"/partials/header.html"},body:{templateUrl:"partials/home.html",controller:"MainCtrl"}}}).state("polls",{url:"/polls/:id",views:{header:{templateUrl:"/partials/header.html"},body:{templateUrl:"partials/poll.html",controller:"MainCtrl"}}}).state("r",{url:"/polls/:id/r",views:{header:{templateUrl:"/partials/header.html"},body:{templateUrl:"partials/result.html",controller:"MainCtrl"}}}),o.otherwise("")}]);